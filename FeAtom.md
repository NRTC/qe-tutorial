
1.25- بررسی اتمFe 
گرچه DFT + U برای آهن بالک بسیار مفید نیست ، ما از این سیستم برای آشنا شدن با محاسبات هابارد   Uاستفاده می‌کنیم.
به طور مقدماتی شما می‌توانید اثر U را روی بالک آهن بررسی کنید فقط با استفاده از مقایسه نتایجی ( به عنوان مثال DOS) که از DFT و DFT + U   بدست می آورید . برای این منظور شما می‌توانید از اسکریپت های run_Fe_NOU و run_Fe_U استفاده کنید .


1.25.1- محاسبه scf
بیایید اسکریپت scf رابررسی کنیم . بخش اصلی فایل ورودی برای محاسبه SCF به شرح زیر است :

&system
ibrav= 1, 
celldm(1)=5.42, 
nat= 2, 
ntyp= 2,
ecutwfc = 30.0, 
ecutrho = 360.0,
occupations='smearing',   smearing='mp',   degauss=0.01,
nbnd = 14,
nspin=2,
starting_magnetization(1)= 0.6
starting_magnetization(2)= 0.6
lda_plus_u = .true.
Hubbard_U(1)= 1.d-20
Hubbard_U(2)= 1.d-20
/
&electrons
mixing_beta = 0.7
conv_thr = 1.0d-9,
/
ATOMIC_SPECIES
Fe1   1. Fe.pbe-nd-rrkjus.UPF
Fe     1. Fe.pbe-nd-rrkjus.UPF
ATOMIC_POSITIONS crystal
Fe1 0.0 0.0 0.0
Fe 0.5 0.5 0.5
توجه کنید که این یک محاسبه DFT + U (. ( lda_plus_u = .true با 1.d-20)= U) بسیار کوچک است . ازآنجاکه توضیحات اولیه این U کوچک هیچ تاثیری روی نتایج ندارد ولی ضروری است کد قابل چاپ ماتریسهای occupation را داشته باشیم، نیاز خواهیم داشت پاسخ سیستم به اختلال بیرونی را بسنجیم .     
این مهم است که توجه داشته باشید که دو اتم در سلول واحد در انواع مختلف توصیف می‌شود : 
  (fe , fe1)این تفاوت را در قسمت شبه پتانسیلها وارد می‌کنیم. در واقع یکی از آنها موضوع پتانسیل اختلالی خواهد بود (fe1) ( اگر ما آنها را به عنوان نوع یکسان توصیف کنیم اختلال به هردو اضافه خواهد شد). به طور کلی اتمی که در آن اختلال است به عنوان نوع متفاوت از دیگران نیاز به توصیف دارد. (حتی باوجود شبه پتانسیل یکسان ) 
پس از آنکه اجرای SCF کامل شد برای شروع محاسبه اختلال آماده ایم .
در فایل خروجی scf به مقدار عددی ethr در آخرین iteration نگاه کنید . 


شکل 133 خروجی scf

سپس عدد مربوط به آن را در قسمت electrons& مقابل diago_thr_init قرار می‌دهیم.
   

شکل 134 قسمتی از ورودی جدید scf
همچنین پارامتر جدید Hubbard_alpha را در محاسبات وارد کرده و برای آن مقادیر متفاوت alpha را به ازای  0.0 , -0.05 , 0.05 , -0.1 , 0.1قرار می‌دهیم.
این یک سری از مقادیر آلفا اطراف صفر است .  این آلفا تنها برای اتم 1 در نظر گرفته می‌شود. 


شکل 135 قسمتی از ورودی جدید scf

برنامه را به ازای آلفاهای مختلف اجرا می‌کنیم در نتیجه خروجی‌های مختلف حاصل می‌شود. 
پس از نوشتن و اجرای صحیح محاسبات به نتایجی از فایلهای خروجی نیازمندیم که این نتایج شامل مقدار عددی (Tr[ns(na)]  (up, down, total ) برای تعداد اتمهای موجود به ازای هر کدام از مقادیر Hubbard_alpha که به صورت جداگانه ران کردیم، می‌باشد. البته لازم به ذکر است که این اطلاعات را از iteraction #1 و End of self-consistent calculation استخراج می‌کنیم.
سپس آنها را در فایل های زیر دسته بندی می‌کنیم. 
1. dn0.at1.da.at2.dat 
2. dn.at1.da.at2.dat

این مقادیر را برای فایل های حالت 1 از iteraction #1  به صورت زیر حاصل می‌شود:


 شکل 136 iteration 1 فایل خروجی scf
و برای فایل های حالت 2 از End of self-consistent calculation به صورت زیر حاصل می‌شود :


شکل 137 End of self-consistent calculation فایل خروجی scf

بدیهی است از آنجا که دو اتم با یکدیگر معادل هستند ، به مختل کردن آنها را به طور جداگانه نیاز نداریم. 
پس از آنکه سری کامل محاسبات تمام شد برای محاسبه U آماده می‌شویم.
1.25.2- بررسی اسکریپت grepnalfa_..._...
صدور فرمان “./grepnalfa_sc1_pbe”. این اسکریپت تمامی occupation ها را برای همه اتم ها از خروجی اجرای اختلال جمع آوری می‌کند و آنها را در فایل های dn.at1.da.at2.dat مینویسد . که در آن at1 مربوط به پاسخی است که اندازه گیری می‌کنیم ، at2 اتمی که در آن اختلال به کار گرفته شده است. 
اسکریپ  grepnalfa_sc1_pbe همچنین فایل file_sc1  که با نام فایل dn*.dat جمع آوری می‌شود را ایجاد می‌کند. برای اجرای آن اسکریپت grepnalfa_sc1_pbe را داخل برنامه قرار می‌دهیم سپس به ویرایش مربوط به نام خروجی‌های برنامه با آلفاهای مختلف می‌پردازیم :

شکل 138 اسکریپت grepnalfa_sc1_pbe
پس از تکمیل آن را با دستور زیر اجرا می‌کنیم :


شکل 139 ران اسکریپت grepnalfa_sc1_pbe

با استفاده از xmgrace می‌توان فایل dn.at1.da.at2.dat و فایل متناظر  dn0.at1.da.at2.dat را رسم کنید. 
شما باید رفتار خطی آلفای n wrt برای هر دو مورد مشاهده کنید. همچنین دو خط در آلفا = 0 با یگدیگر متفاوتند .کد محاسبه ماتریس پاسخ و برگردانی آنها از resp_mat.f90 است.
1.25.3- تولید فایلr.x  
برای اجرای مراحل بعدی و محاسبه نهایی u نیاز به فایل r.x داریم. برای تولید فایل r.x به دو فایل comp_resp_mat.j و resp_mat.f90 نیاز داریم.
فایل comp_resp_mat.j به صورت زیر است:


شکل 140 فایل comp_resp_mat.j
در نتیجه در ترمینال داریم :


شکل 141 ترمینال فایل comp_resp_mat.j
پس از ران این قسمت فایل r.x   تولید می‌شود:


شکل 142 تولید r.x
1.25.4- اجرایresp_mat 
پس از تولید فایل r.x می‌توان فایل resp_mat.in را اجرا کرد. 
فایل ورودی resp_mat.in به شرح زیر ساخته می‌شود:
&input_mat
# تعداد انواع اتمها (اتمهایی که برای محاسبه u به‌کار می‌روند)                                     ntyp = 1  
# تعداداتمهای هر نوع                                                                                      na(1) = 2
# تعداد اختلال (آلفا)                                                                                       nalfa = 5
 Magn =.true.
# تنها زمانی استفاده می‌شود که دواتم در یک موقعیت کریستالوگرافی برابر با مغناطش مختلف باشند، زمانیکه چنین شرایطی را داشته باشیم می‌توان این پارامتر را حذف کرد یا از گزینه .fals. استفاده کرد. که در اینجا چون این شرایط را نداریم می‌توان این گزینه را حذف کرد.
# فایل شامل موقعیتهای اتمی و بردارهای سلول واحد                                filepos = 'pos_sc1'    
توجه کنید که درفایل 'pos_sc1' در مقابل موقعیتهای اتمی اعداد مربوط به مغناطش اتمها را نیز وارد کنیم، به این طریق که برای مغناطش مثبت مقدار 1+ ، مغناطش منفی مقدار 1- و برای اتمهایی که بدون مغناطش هستند مقدار 0 را قرار می‌دهیم .
# برای افزودن یک "پس زمینه" خنثی .                                                     back = 'neutral'
# فایل شامل اسامی فایل های dn*dat                                                  filednda = 'file_sc1'
n1 = 4
# تعداد سلولهای واحد در هر جهت برای ساخت ابرسلول                                                n2 = 4
# برون یابی ( در این حالت یک ابرسلول 4x4x4 SC آن )                                              n3 = 4
&end
برای اجرای این مرحله نیاز به ران توسط فرمان زیرداریم.
./r.x < resp_mat.in> resp_mat.out

فرمان “./r.x < resp_mat.in”. فایل Umat.out محتویات ماتریس خطی را ایجاد می‌کند و تفاوت بین معکوسشان  U را تعیین می‌کند . در فایل Umat.out جستجو کنید برای مقادیر زیر :
Number of atom ,  U1 

1.25.5- اجرای اسکریپتucalc_sc1_pbe.j  
اسکریپت  ucalc_sc1_pbe.j همه عملیات لازم برای محاسبه U را به طورخودکار انجام می‌دهد. در این اسکریپت دقت کنید کنید که ابتدا اطلاعات از فایل resp_mat0.in فراخوانی ‌شده، سپس داخل فایل resp_mat.in قرار داده می‌شود و برای یک حلقه به ازای n1,n2,n3 های مختلف این محاسبات تکرار می‌شود.

شکل 143 اسکریپت  ucalc_sc1_pbe.j
کل روش هم اکنون می‌تواند با شروع محاسبات در ابرسلول بزرگتر تکرار شود.
برگردید به فهرست منشا و مجددا اجرای run_Fe_bcc8_ucalc_pbe را شروع کنید که محاسبات اختلالی روی ابرسلول  BCC 2x2x2 با 8 اتم را انجام می‌دهد. انواع و موقعیت اتم ها به صورت زیر است :


شکل 144 قسمتی از فایل ورودی Fe_bcc8_ucalc_pbe

لطفا توجه کنید اتمی که در آن آلفا استفاده شده است همیشه به عنوان نوعی متفاوت از دیگران توصیف می‌شود هرچند با PP یکسان و همیشه در مبدا (0،0،0) از سلول واحد قرار می گیرد.  
در این راه تقارن بیشتر از حد ممکن نگه داشته می‌شود و محاسبات در زمان کوتاه تر کامل می‌شود. پس از تکرار مجموعه یکسان محاسبات شروع می‌شود بعلاوه از یک ابرسلول SC 2x2x2 با 16 اتم نتایج زیر را از همگرایی بیشتر و بیشتر سلول واحد پیدا می‌کنیم:

شکل 145 نمودار U
خط سیاه برون یابی داده ها از 2 اتم سلول واحد SC ، خط قرمز از 8 اتم سلول BCC ، خط آبی از 16 اتم ابرسلول SC را توصیف می‌کند. سطح مسطح خط آبی مقدار همگرایی U است که می‌توان با برونیابی نتایج 8 اتم سلول BCC  تقریب زد. 
